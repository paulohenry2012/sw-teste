---
- name: "Teste de comandos shell"
  host: "{{groups['srv01']}}"
  gather_facts: no


  tasks:

    - name: Teste de acesso
      ansible.builtin.shell: |
        set timeout 300
        spawn ssh root@"{{ item }}"

        expect "*?assword:*"
        send " VMware1!\n"

        expect "\n root"
        send "df -lh\n"

        exit 0
      args:
        executable: /usr/bin/expect
      delegate_to: localhost
      loop: "{{groups['host02']}}"
      register: connection_out


    - name: "Resultado telnet"
      ansible.builtin.debug:
          msg: "{{ connection_out.results[0] }}"
      run_once: true  